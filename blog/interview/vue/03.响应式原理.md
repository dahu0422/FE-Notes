# 响应式原理

响应式：在不手动触发的情况下，数据改变后自动更新视图。

## 观察者模式
观察者模式包含两个角色——观察者（Observer）和被观察者（Subject）。被观察者会维护一个观察者列表，当状态发生改变时会通知观察者。观察者调用更新方法。

## 发布订阅模式
发布订阅模式中包含发布者、订阅者和事件中心三个角色。发布者和订阅者之间是解耦的，发布者负责将**消息发布**至事件中心。订阅者负责从事件中心接收**订阅消息**， 它们之间没有直接的依赖关系。

发布订阅模式在 vue 中应用场景：
1. **事件总线 Event Bus**：Vue 实例可以作为事件总线使用，用于非父子组件之间的通信。
```js
const eventBus = new Vue()

// 发布事件
eventBus.$emit('eventName', data)

// 订阅事件
eventBus.$on('eventName', data => {
  console.log(data)
})
```
2. $emit 和 $on
3. Vuex：状态管理库，通过 mutations 和 actions 分发状态变更，getters负责订阅状态

## Vue 响应式各组件之间关系
Vue 功能
- 负责接受初始化的参数（options）
- 负责把 data 中的属性注入到 Vue 实例，转换为 getter/setter
- 负责调用 observer 监听 data 中所有属性的变化
- 负责调用 complier 解析指令/差值表达式
  

Observer 功能
- 负责把 data 选项中的属性转换成响应式数据。data 中的某个属性也是对象，把该属性转换成响应式数据。
- 数据变化发送通知；

compiler 功能
- 负责编译模板，解析指令、差值表达式
- 负责页面的首次渲染
- 当数据变化后重新渲染页面

dep 功能：负责收集观察者，当数据发生变化时，通知观察者更新。

watcher 功能：
- 当数据变化触发依赖，dep通知所有watcher实例更新视图
- 自身实力化时往dep对象中添加自己