# vue 权限管理

权限管理一般需求是页面权限和按钮权限的管理，具体实现时分为前端和后端两种实现方式

## 页面权限

### 前端实现

前端方案会把所有路由信息在前端配置，通过路由守卫要求用户登录，用户登录后根据角色过滤出路由表。

比如我会配置一个 `asyncRoutes` 数组，需要认证的页面在其路由的 `meta` 中添加一个 `role` 字段，等获取用户角色之后取两者交集，若结果不为空则说明可以访问。过滤结束后，剩下的路由就是该用户能访问的页面，最后通过 `router.addRoutes()` 添加到路由表中。

### 后端实现

后端会把所有页面路由信息存在数据库中，用户登录时根据角色查询到其能访问的所有页面的信息返回给前端，前端在通过 `router.addRoutes()` 添加到路由表中。

## 按钮权限

按钮权限的控制通常会实现一个**指令**，例如 `v-permission`，将按钮要求角色通过值传给 v-permission 指令，在指令的 `mounted` 钩子中判断当前用户角色和按钮是否存在交集，有则保存按钮。

```js
app.directive('permission', {
  mounted(el, binding) {
    if (binding.value.includes(user.role)) {
      el.style.display = 'block'
    } 
  }
})
```

## 优缺点

纯前端的优点是实现简单，不需要额外权限管理页面，但是维护起来问题较大，有新的页面和角色需求就要修改前端代码重新部署。

服务端可以通过专门的角色和权限管理页面，配置页面和按钮权限到数据库，每次登录获取最新的路由信息。
